<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="blockt-prepaidclaim">
  <template>
    <style is="custom-style" include="shared-styles"></style>

      <div class="container">

          <h3>Claim invite code</h3>
         
          <paper-icon-button toggles icon="favorite" on-tap="doClaimInvite"></paper-icon-button>

      </div>  
</template>

<script>
    (function() {
      'use strict';
      
      Polymer({
        is: 'blockt-prepaidclaim',

        properties: {
          invitecode: {
            type: String
          },
          web3: {
            type: Object,
            observer: '_web3'
          },
          account: {
            type: String
          }
        },

        ready: function(){


          // lightwallet.importPrivateKey = function(privatekey) {

          //   //if (hdPathString === undefined) {
          //   hdPathString = this.defaultHdPathString;
          //   //}

          //   // if (this.ksData[hdPathString].info.purpose !== 'sign') {
          //   //   throw new Error('KeyStore.generateNewAddress: Address not defined when purpose is not "sign"');
          //   // }

          //   if (!this.encSeed) {
          //     throw new Error('KeyStore.generateNewAddress: No seed set');
          //   }
          //   //  n = n || 1;
          //   //  var keys = this._generatePrivKeys(pwDerivedKey, n, hdPathString);


          //   var privkeyBuf = privatekey.toBuffer();

          //   var privkeyHex = privkeyBuf.toString('hex');

          //   var encPrivKey = KeyStore._encryptKey(privkeyHex, pwDerivedKey);
          //   var keyObj = {
          //     privKey: privkeyHex,
          //     encPrivKey: encPrivKey
          //   }


          //   var address = KeyStore._computeAddressFromPrivKey(keyObj.privKey);
          //   this.ksData[hdPathString].encPrivKeys[address] = keyObj.encPrivKey;
          //   this.ksData[hdPathString].addresses.push(address);
          // };


        },

        close: function(){
        },

        _web3: function(){

        },

        doClaimInvite: function() {
          console.log('CLAIM INVITE');
          var parts = this.invitecode.split('-');

          this.privatekey = parts[0];
          this.prepaidcontractaddress = parts[1];

          console.log('TODO: call claim() from contract', this.prepaidcontractaddress);
          console.log('using keypair ', this.publickey, this.privatekey);
          console.log('recepient of funds =>', this.account);

          console.log('calculated pubkey', lightwallet.keystore._computeAddressFromPrivKey(this.privatekey));

          debugger;
          var secretSeed = lightwallet.keystore.generateRandomSeed();

          lightwallet.keystore.deriveKeyFromPassword('test', function(err, pwDerivedKey) {

            var keystore = new lightwallet.keystore(secretSeed, pwDerivedKey);

            //lightwallet.keystore.importPrivateKey(this.privatekey);

          });


        },

      });
    })();
  </script>

</dom-module>